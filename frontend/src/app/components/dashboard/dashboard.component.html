<div class="flex h-screen overflow-hidden bg-gray-50">
  <!-- Sidebar -->
  <aside 
    [class]="'fixed left-0 top-0 z-50 flex h-screen flex-col overflow-y-hidden bg-slate-900 transition-all duration-300 ease-in-out lg:static lg:translate-x-0 ' + (isSidebarOpen ? 'translate-x-0 w-72' : '-translate-x-full lg:w-20')"
  >
    <!-- Sidebar Header -->
    <div class="flex items-center justify-between gap-2 px-6 py-6">
      <a routerLink="/dashboard" class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-indigo-600 text-white shadow-lg shadow-indigo-500/30">
          <span class="font-bold text-lg">T</span>
        </div>
        @if (isSidebarOpen) {
          <span class="text-xl font-bold text-white tracking-tight">Tricol</span>
        }
      </a>

      <button 
        (click)="toggleSidebar()" 
        class="block rounded-lg p-2 text-gray-400 hover:bg-slate-800 hover:text-white transition-colors lg:hidden"
        aria-label="Toggle sidebar"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 18">
          <path d="M19 8.175H2.98748L9.36248 1.6875C9.69998 1.35 9.69998 0.825 9.36248 0.4875C9.02498 0.15 8.49998 0.15 8.16248 0.4875L0.399976 8.3625C0.0624756 8.7 0.0624756 9.225 0.399976 9.5625L8.16248 17.4375C8.31248 17.5875 8.53748 17.7 8.76248 17.7C8.98748 17.7 9.17498 17.625 9.36248 17.475C9.69998 17.1375 9.69998 16.6125 9.36248 16.275L3.02498 9.8625H19C19.45 9.8625 19.825 9.4875 19.825 9.0375C19.825 8.55 19.45 8.175 19 8.175Z"/>
        </svg>
      </button>
    </div>

    <!-- Sidebar Menu -->
    <div class="flex flex-col overflow-y-auto scrollbar-hide">
      <!-- User Info -->
      <div class="mx-4 mb-6 rounded-xl bg-slate-800/50 p-4">
        <div class="flex items-center gap-3">
          <div class="h-11 w-11 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-semibold shadow-lg">
            {{ getUserInitials() }}
          </div>
          @if (isSidebarOpen && currentUser) {
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-white truncate">{{ currentUser.firstName }} {{ currentUser.lastName }}</p>
              <p class="text-xs text-gray-400 truncate">{{ getUserRole() }}</p>
            </div>
          }
        </div>
      </div>

      <!-- Menu -->
      <nav class="px-3 py-2">
        <div>
          @if (isSidebarOpen) {
            <h3 class="mb-3 ml-3 text-xs font-semibold uppercase tracking-wider text-gray-500">
              Menu
            </h3>
          }

          <ul class="space-y-1">
            @for (item of menuItems; track item.label) {
              <li>
                @if (item.children && item.children.length > 0) {
                  <!-- Menu with Submenu -->
                  <button
                    (click)="toggleSubmenu(item.label)"
                    [class]="'group relative flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-all duration-200 ' + (isSubmenuOpen(item.label) ? 'bg-slate-800 text-white' : 'text-gray-300 hover:bg-slate-800 hover:text-white')"
                  >
                    <span [innerHTML]="item.icon" class="flex-shrink-0 w-5 h-5"></span>
                    @if (isSidebarOpen) {
                      <span class="flex-1 text-left">{{ item.label }}</span>
                      <svg
                        [class]="'w-4 h-4 transition-transform duration-200 ' + (isSubmenuOpen(item.label) ? 'rotate-180' : '')"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                      </svg>
                    }
                  </button>

                  @if (isSubmenuOpen(item.label) && isSidebarOpen) {
                    <ul class="mt-1 space-y-1 pl-8">
                      @for (child of item.children; track child.label) {
                        <li>
                          <a
                            [routerLink]="child.route"
                            routerLinkActive="bg-indigo-600/20 text-indigo-400 border-l-2 border-indigo-500"
                            class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-gray-400 transition-all hover:text-white hover:bg-slate-800"
                          >
                            <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                            {{ child.label }}
                          </a>
                        </li>
                      }
                    </ul>
                  }
                } @else {
                  <!-- Single Menu Item -->
                  <a
                    [routerLink]="item.route"
                    routerLinkActive="bg-indigo-600 text-white shadow-lg shadow-indigo-500/30"
                    [routerLinkActiveOptions]="{exact: true}"
                    class="group flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-300 transition-all duration-200 hover:bg-slate-800 hover:text-white"
                  >
                    <span [innerHTML]="item.icon" class="flex-shrink-0 w-5 h-5"></span>
                    @if (isSidebarOpen) {
                      <span>{{ item.label }}</span>
                    }
                  </a>
                }
              </li>
            }
          </ul>
        </div>

        <!-- Logout Button -->
        <div class="mt-6 pt-6 border-t border-slate-700">
          <button
            (click)="onLogout()"
            class="group flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-gray-300 transition-all duration-200 hover:bg-red-500/10 hover:text-red-400"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
            </svg>
            @if (isSidebarOpen) {
              <span>Logout</span>
            }
          </button>
        </div>
      </nav>
    </div>
  </aside>

  <!-- Content Area -->
  <div class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden">
    <!-- Header -->
    <header class="sticky top-0 z-40 flex w-full bg-white border-b border-gray-200">
      <div class="flex flex-grow items-center justify-between px-4 py-4 md:px-6 lg:px-8">
        <div class="flex items-center gap-4">
          <!-- Hamburger Toggle Button -->
          <button
            (click)="toggleSidebar()"
            aria-label="Toggle sidebar"
            class="inline-flex items-center justify-center rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-900 transition-colors lg:hidden"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>

          <div class="hidden sm:block">
            <h1 class="text-xl font-semibold text-gray-900">Dashboard</h1>
            <p class="text-sm text-gray-500">Welcome back, {{ currentUser?.firstName }}!</p>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <!-- User Area -->
          <div class="flex items-center gap-3">
            <div class="hidden text-right sm:block">
              <p class="text-sm font-medium text-gray-900">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</p>
              <p class="text-xs text-gray-500">{{ getUserRole() }}</p>
            </div>

            <div class="relative">
              <div class="h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm shadow-lg cursor-pointer hover:shadow-xl transition-shadow">
                {{ getUserInitials() }}
              </div>
              <span class="absolute bottom-0 right-0 block h-2.5 w-2.5 rounded-full bg-green-500 ring-2 ring-white"></span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-6 lg:p-8">
      <!-- Router Outlet for Child Routes -->
      <router-outlet></router-outlet>
    </main>
  </div>

  <!-- Sidebar Overlay -->
  @if (isSidebarOpen) {
    <div
      (click)="toggleSidebar()"
      class="fixed inset-0 z-40 bg-black/50 backdrop-blur-sm lg:hidden transition-opacity"
    ></div>
  }
</div>
